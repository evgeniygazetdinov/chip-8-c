#include <stdint.h>
#include <stdio.h>
#include <stdlib.h>
#include <stdarg.h>
#include "prepare.h"
#include "helpers.h"


uint16_t PC = 0x200;
uint8_t memory[4096];
uint8_t fontset[80] = {
    // 0
    0xF0, 0x90, 0x90, 0x90, 0xF0,
    // 1
    0x20, 0x60, 0x20, 0x20, 0x70,
    // 2
    0xF0, 0x10, 0xF0, 0x80, 0xF0,
    // 3
    0xF0, 0x10, 0xF0, 0x10, 0xF0,
    // 4
    0x90, 0x90, 0xF0, 0x10, 0x10,
    // 5
    0xF0, 0x80, 0xF0, 0x10, 0xF0,
    // 6
    0xF0, 0x80, 0xF0, 0x90, 0xF0,
    // 7
    0xF0, 0x10, 0x20, 0x40, 0x40,
    // 8
    0xF0, 0x90, 0xF0, 0x90, 0xF0,
    // 9
    0xF0, 0x90, 0xF0, 0x10, 0xF0,
    // A
    0xF0, 0x90, 0xF0, 0x90, 0x90,
    // B
    0xE0, 0x90, 0xE0, 0x90, 0xE0,
    // C
    0xF0, 0x80, 0x80, 0x80, 0xF0,
    // D
    0xE0, 0x90, 0x90, 0x90, 0xE0,
    // E
    0xF0, 0x80, 0xF0, 0x80, 0xF0,
    // F
    0xF0, 0x80, 0xF0, 0x80, 0x80
}; 

void set_zeros_into_memory(){
    for (int i = 0; i < 4096; i++) {
    memory[i] = 0; 
}
}
void set_values_into_memory(){
    for (int i = 0; i < 80; i++) {
        memory[0x50 + i] = fontset[i];
    }
}
void initialize_memory(){
    set_zeros_into_memory();
    set_values_into_memory();
}

void upload_file_to_memory(const char* filename){
    FILE *rom = fopen(filename, "rb");
    if (rom == NULL) {
        fatal_error("Не найден файл %s", filename);
    }
    fseek(rom, 0, SEEK_END);
    long file_size = ftell(rom);
    printf("begin read file\n");

    if (rom) {
        fread(&memory[0x200], sizeof(uint8_t), file_size, rom);
        fclose(rom);
    }
    if (!rom) {
        printf("error detected");
    }
    printf("file uploaded as bytes into memory\n");
}